<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Swarm Attack</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="/imgtec-fullstack-challenge/js/pixi.min.js"></script>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    <script src="/imgtec-fullstack-challenge/js/howler.js"></script>
    <script src="/imgtec-fullstack-challenge/js/bump.js"></script>
    <script src="https://unpkg.com/@typicode/pegasus/dist/pegasus.min.js"></script>
    <script>
    var sound = new Howl({
  src: ['/imgtec-fullstack-challenge/sounds/background.mp3']
});

sound.play();
    </script>
    <style>
/* stylesheet */
      <style type="text/css">
          .tg {
            border-collapse: collapse;
            border-color: #9abad9;
            border-spacing: 0;
          }
          .tg td {
            background-color: #ebf5ff;
            border-color: #9abad9;
            border-style: solid;
            border-width: 1px;
            color: #444;
            font-family: Arial, sans-serif;
            font-size: 14px;
            overflow: hidden;
            padding: 10px 5px;
            word-break: normal;
          }
          .tg-baqh{
            background-color: #409cff !important;
            border-color: #9abad9;
            border-style: solid;
            border-width: 1px;
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 14px;
            font-weight: normal;
            overflow: hidden;
            padding: 10px 5px;
            word-break: normal;
            text-align: center;
            vertical-align: top;
          }
          .tg .tg-0lax {
            text-align: left;
            vertical-align: top;
          }
          .tg .tg-7zrl {
            text-align: left;
            vertical-align: bottom;
          }
        </style>
    </style>
  </head>
  <body>
<!-- main frame -->
    <div class="row">
      <div class="col-md-2" id="score1">
      </div>
      <div class="col-md-8">
        <center>
<!-- wartime counter -->
          <div><h3><b>üí™üèª Playground</b></h3></div><div style="float:right;"><a target="_blank" href="https://github.com/Grv-Singh/imgtec-fullstack-challenge">‚Ñπ more info</a></div>
        </center>
<!-- playground to emulate fight -->
        <div id="playground" class="row"></div>
        <div style="float:left;"><h3 id="counter" style="color:red;float:left;"></h3></div>
        
        <div style="float:right;">
       &nbsp; &nbsp;
            <a href="#" onclick="window.location.reload();" class="myButton">Randomise bee formation üîÄ </a>
            <style>
              .myButton {
                box-shadow: 0px 10px 14px -7px #276873;
                background: linear-gradient(
                  to bottom,
                  #599bb3 5%,
                  #408c99 100%
                );
                background-color: #599bb3;
                border-radius: 8px;
                display: inline-block;
                cursor: pointer;
                color: #ffffff;
                font-family: Arial;
                font-size: 20px;
                font-weight: bold;
                padding: 13px 32px;
                text-decoration: none;
                text-shadow: 0px 1px 0px #3d768a;
              }
              .myButton:hover {
                background: linear-gradient(
                  to bottom,
                  #408c99 5%,
                  #599bb3 100%
                );
                background-color: #408c99;
              }
              .myButton:active {
                position: relative;
                top: 1px;
              }
            </style>
          &nbsp; &nbsp;
        </div>
        
        <br><br>
          <div>
            <h1 id="swarm-attack">Swarm Attack</h1>
<p>This simulation on swarm attack within 2 beehives, The queen is the most potent to damages, The Warrior has good attackability, The Worker is like a pawn. Bees move in the direction of their prey with random velocities. With each hit, the health of enemy deplets, denoted by their fading out from background. Whereas the attacker gains a hit, as shown in table. The simulation stays until a Queen Bee is alive, queen&#39;s death marks as loss of whole swarm. Some bees have randomly been chosen to defend their position and they are the ones who are stable at same place. The tables on the sides show live score of each swarm. Any bee with negative health, is known to be dead. The net time of engagement and falling of one of the troop is shown in the counter. One can random the start position of Bees, with the randomization button. The notifier at the bottom shows live attacks &amp; what is the status of it. Bees should be safe from corners as it&#39;s vulnerable to bees coming from either directions (N-W &amp; S-E)</p>
<h2 id="team-a-lime-1-queen-15-warriors-20-workers">Team A : Lime | 1 Queen | 15 Warriors | 20 Workers</h2>
<h2 id="team-b-red-1-queen-15-warriors-20-workers">Team B : Red | 1 Queen | 15 Warriors | 20 Workers</h2>
<table>
<thead>
<tr>
<th>Role &nbsp;</th>
<th>Damage &nbsp;</th>
<th>Look &nbsp;</th>
<th>Health &nbsp;</th>
</tr>
</thead>
<tbody>
<tr>
<td>Queen</td>
<td>&nbsp; 1</td>
<td><img src="https://raw.githubusercontent.com/Grv-Singh/imgtec-fullstack-challenge/main/vectors/Queen_bee_A.png" alt=""></td>
<td>50</td>
</tr>
<tr>
<td>Warrior</td>
<td>&nbsp; 4-7</td>
<td><img src="https://raw.githubusercontent.com/Grv-Singh/imgtec-fullstack-challenge/main/vectors/Warrior_bee_A.png" alt=""></td>
<td>10</td>
</tr>
<tr>
<td>Worker</td>
<td>&nbsp; 2-4</td>
<td><img src="https://raw.githubusercontent.com/Grv-Singh/imgtec-fullstack-challenge/main/vectors/Worker_bee_A.png" alt=""></td>
<td>5</td>
</tr>
</tbody>
</table>
<ul>
<li>Immobile bees can be counted as defendants of beehive.
<li>With respective damage of each bite, the health depletes, denoted by being faded away from playground.</li>
</li>
<li>Some bees seem to rotate in circle due to <a href="https://en.wikipedia.org/wiki/Stroboscopic_effect#:~:text=The%20stroboscopic%20effect%20is%20a,of%20short%20or%20instantaneous%20samples." target="_blank">Stroboscopic effect</a>.</li>
</ul>
<h3 id="check-complete-logs-of-simulation-">Check complete logs of simulation :</h3>
<p>Input <code>console.log(logs);</code> in browser console</p>
<h2 id="sources">Sources</h2>
<p>Sound : <a href="https://www.soundsnap.com/" target="_blank">Bees Sound - Soundsnap</a></p>
<p>Libraries : <a href="https://www.pixijs.com/" target="_blank">Pixie</a></p>
<h2 id="references">References</h2>
<p>Theory :  <a href="https://www.mdbka.com/bee-information/#:~:text=The%20main%20difference%20is%20that,food%2C%20insects%2C%20or%20spiders.&text=The%20worker%20bees%20are%20female,do%20not%20have%20a%20sting." target="_blank">Bee Information</a></p>
<p>Idea : <a href="https://www.youtube.com/watch?v=mDR0_yfKQa0" target="_blank">Video</a></p>
<h2 id="future-scope">Future Scope</h2>
<ul>
<li>Keyboard controls.</li>
<li><p>Responsive Design</p>
<h4 id="note-clear-cache-once-in-a-while-github-cdn-seems-to-deliver-audio-not-all-the-time-simulation-requires-one-to-be-active-on-tab-">Note : Clear cache once in a while, Github CDN seems to deliver audio not all the time. Simulation requires one to be active on tab.</h4>
</li>
</ul>
        </div>
      </div>
      <div class="col-md-2" id="score2" style="float:right;">
        <iframe src="/imgtec-fullstack-challenge/sounds/background.mp3" allow="autoplay" style="display:none" id="iframeAudio"></iframe>
      </div>
    </div>
    <script>
// main counter
      var count = 0;
// maintaining sprites
      var spritesA = [], spritesB = [];
      var logs = [];
// scores data structure
      let b = new Bump(PIXI);
      let loader = PIXI.loader,
        resources = PIXI.loader.resources,
        TextureCache = PIXI.utils.TextureCache,
        Sprite = PIXI.Sprite,
        Rectangle = PIXI.Rectangle;
      let app = new PIXI.Application({
        width: 1024,
        height: 704,
        antialias: true, 
        transparent: true,
        resolution: 1, 
        forceCanvas: true,
      });
// making window
      document.getElementById("playground").appendChild(app.view);

      loader.add("vectors/sprites/bees.json").load(setup);
// getting shaders
      let style = new PIXI.TextStyle({
        fontFamily: "Arial",
        fontSize: 24,
        fill: "white",
        stroke: "#ff3300",
        strokeThickness: 4,
        dropShadow: true,
        dropShadowColor: "#000000",
        dropShadowBlur: 4,
        dropShadowAngle: Math.PI / 6,
        dropShadowDistance: 6,
      });

      let message = new PIXI.Text("Fight to survive, begin !", style);
      message.position.set(200, 500);
      app.stage.addChild(message);
      app.renderer.autoDensity = true;
      app.renderer.view.style.position = "relative";
      app.renderer.view.style.display = "block";
      app.renderer.autoResize = true;
      app.renderer.resize(window.innerWidth, window.innerHeight);

      var queenA, queenB, id;
      var blobAWo, blobBWo, blobA, blobB;
      let state = play;
// setup of drawings
      function setup() {
        id = loader.resources["vectors/sprites/bees.json"].textures;
        queenA = new Sprite(
          loader.resources["vectors/sprites/bees.json"].textures[
            "Queen_bee_A.png"
          ]
        );

        queenB = new Sprite(
          loader.resources["vectors/sprites/bees.json"].textures[
            "Queen_bee_B.png"
          ]
        );
// random direction movement
        queenA.vx = randomInt(-1,1);
// attacks B
        queenB.vx = randomInt(-1,1);
// attacks A
        queenA.vy = randomInt(-1,1);
// attacks B
        queenB.vy = randomInt(-1,1);
// attacks A
        queenA.y = 212;
        queenA.x = 10;

        queenB.x = 900;
        queenB.y = 212;
// add sprites to board
        app.stage.addChild(queenB);
        app.stage.addChild(queenA);
        spritesA.push(queenA);
        spritesB.push(queenB);
        let numberOfBlobs = 15,
          spacing = 48,
          xOffset = 150;
        for (let i = 0; i < numberOfBlobs; i++) {
          blobA = new Sprite(id["Warrior_bee_A.png"]);
          blobB = new Sprite(id["Warrior_bee_B.png"]);
          let alt = new PIXI.Text(i.toString());
          alt.position.set(blobA.x+10, blobA.y+10);
          app.stage.addChild(alt);
          let alt2 = new PIXI.Text(i.toString());
          alt2.position.set(blobB.x+10, blobB.y+10);
          app.stage.addChild(alt2);
          
          blobA.vx = randomInt(-1,1) ;
          blobB.vx = randomInt(-1,1) ;
          blobA.vy = randomInt(-1,1) ;
          blobB.vy = randomInt(-1,1) ;
          let xA = spacing * i + xOffset;
          let yA = randomInt(0, app.stage.height - blobA.height);

          let xB = spacing * i + xOffset;
          let yB = randomInt(0, app.stage.height - blobB.height);
          blobA.x = xA;
          blobA.y = yA;
          blobB.x = xB;
          blobB.y = yB;
          app.stage.addChild(blobA);
          app.stage.addChild(blobB);
          spritesA.push(blobA);
          spritesB.push(blobB);
        }
        app.ticker.add((delta) => gameLoop(delta));
        let numberOfBlobsWo = 20,
          spacingWo = 48,
          xOffsetWo = 150;
        for (let i = 0; i < numberOfBlobsWo; i++) {
          blobAWo = new Sprite(id["Worker_bee_A.png"]);
          blobBWo = new Sprite(id["Worker_bee_B.png"]);
          let alt = new PIXI.Text(i.toString());
          alt.position.set(blobAWo.x+10, blobAWo.y+10);
          app.stage.addChild(alt);
          let alt2 = new PIXI.Text(i.toString());
          alt2.position.set(blobBWo.x+10, blobBWo.y+10);
          app.stage.addChild(alt2);
          blobAWo.vx = randomInt(-1,1) ;
          blobBWo.vx = randomInt(-1,1) ;
          blobAWo.vy = randomInt(-1,1) ;
          blobBWo.vy = randomInt(-1,1) ;
 //`xOffset` determines the point from the left of the screen
          let xA = spacingWo * i + xOffsetWo;
 //(`randomInt` is a custom function - see below)
          let yA = randomInt(0, app.stage.height - blobAWo.height);

          let xB = spacingWo * i + xOffsetWo;
 //(`randomInt` is a custom function - see below)
          let yB = randomInt(0, app.stage.height - blobBWo.height);
          blobAWo.x = xA;
          blobAWo.y = yA;
 // blobAWo.vy = 0;
          blobBWo.x = xB;
          blobBWo.y = yB;
 // blobAWo.vy = 0;
          app.stage.addChild(blobAWo);
          app.stage.addChild(blobBWo);
          spritesA.push(blobAWo);
          spritesB.push(blobBWo);
        }

// looping the logic in game
        app.ticker.add((delta) => gameLoop(delta));
        setTimeout(function(){
        if(scoreA[1][1] <= 0){
          sound.pause();
          alert(" üëë Queen A dead üòï, Swarm B wins! üèÜ");
          window.location.reload();
          return false;
        }
        if(scoreB[1][1] <= 0){
          sound.pause();
          alert(" üëë Queen B dead üòï, Swarm A wins! üèÜ");
          window.location.reload();
          return false;
        }
          }, 10000);
      }
      function gameLoop(delta) {
        state(delta);
      }
      let hit = false;

      function play(delta) {
        for(i=0;i<spritesB.length;i++){
// rotation to get bee effect

        if(spritesB[i].x>=window.innerWidth || spritesB[i].x <=0){
          spritesB[i].vx *=-1;
          spritesB[i].rotation += 1;
        }
        if(spritesB[i].y<=0 || spritesB[i].y >=window.innerHeight){
          spritesB[i].vy *=-1;
          spritesB[i].rotation += 1;
        }  
        spritesB[i].x += (spritesB[i].vx*3);
        spritesB[i].y += (spritesB[i].vy*3);
        }
        for(j=0;j<spritesA.length;j++){
// rotation to get bee effect

        if(spritesA[j].x>=1024 || spritesA[j].x <=0){
          spritesA[j].vx *=-1;
          spritesA[j].rotation += 1;
        }
        if(spritesA[j].y<=0 || spritesA[j].y >=704){
          spritesA[j].vy *=-1;
          spritesA[j].rotation += 1;
        }
        
        spritesA[j].x -= (spritesA[j].vx*3);
        spritesA[j].y -= (spritesA[j].vy*3);
        }
        
        for (let i = 0; i < spritesA.length; i++) {
  var c1 = spritesA[i];
  for (let j = i ; j < spritesB.length; j++) {
    let c2 = spritesB[j];
    if (b.hit(c1, c2, true, true)) {
// getting metadata of the 2 bees fighting     
          let character1 = (c1._texture.textureCacheIds[0]).split('_')[0];
          let swarm1 = ((c1._texture.textureCacheIds[0]).split('_')[2]).split('.')[0];
          let character2 = (c2._texture.textureCacheIds[0]).split('_')[0];
          let swarm2 = ((c2._texture.textureCacheIds[0]).split('_')[2]).split('.')[0];
          let damageA = 0,damageB = 0;
         
          if(swarm2!=swarm1){
            switch(character1){
              case 'Warrior': damageA = randomInt(4,7); damageB = randomInt(4,7); c2.alpha -= 1/50;
                break;
              case 'Worker' : damageA = randomInt(2,4); damageB = randomInt(2,4); c2.alpha -= 1/5;
                break;
              case 'Queen' : damageA = 1; damageB = 1; c2.alpha -= 1/10;
                break;
            }
            switch(character2){
              case 'Warrior': damageA = randomInt(4,7); damageB = randomInt(4,7); c1.alpha -= 1/50;
                break;
              case 'Worker' : damageA = randomInt(2,4); damageB = randomInt(2,4); c1.alpha -= 1/5;
                break;
              case 'Queen' : damageA = 1; damageB = 1; c1.alpha -= 1/10;
                break;
            }
             let msg =  ('‚ö† ' + character1 + ' ' + swarm1 + ' ' + damageA +' üó° to ' + character2 + ' ' + swarm2 + '      ' + character2 + ' ' + swarm2 + ' ' + damageB +' üó° to ' + character1 + ' ' + swarm1);
            message.text = msg;
            let arr = [];
            arr.push(msg);
            logs.push(arr);
            if(scoreA[parseInt(getKeyByValue(spritesA,c1))+1][1] >= 0){
          scoreA[parseInt(getKeyByValue(spritesA,c1))+1][1]-=damageB;
          scoreA[parseInt(getKeyByValue(spritesA,c1))+1][2]+=1;
            }
            
            if(scoreB[parseInt(getKeyByValue(spritesB,c2))+1][1] >= 0){
          scoreB[parseInt(getKeyByValue(spritesB,c2))+1][1]-=damageA;
          scoreB[parseInt(getKeyByValue(spritesB,c2))+1][2]+=1;
            }
            
          update();
          }
       }
        
    }
}

  

}


function getKeyByValue(object, value) {
  return Object.keys(object).find(key => object[key] === value);
}
        
function update() {
// update scores
          updateTable(scoreA, "score1");
          updateTable(scoreB, "score2");  
}
// random number genarator
      function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

// scoreboard
      var scoreA = [
        ["Role","Health","Hits"],
        ["Queen", 50, 0],
        ["Warrior1", 10, 0],
        ["Warrior2", 10, 0],
        ["Warrior3", 10, 0],
        ["Warrior4", 10, 0],
        ["Warrior5", 10, 0],
        ["Warrior6", 10, 0],
        ["Warrior7", 10, 0],
        ["Warrior8", 10, 0],
        ["Warrior9", 10, 0],
        ["Warrior10", 10, 0],
        ["Warrior11", 10, 0],
        ["Warrior12", 10, 0],
        ["Warrior13", 10, 0],
        ["Warrior14", 10, 0],
        ["Warrior15", 10, 0],
        ["Worker1", 5, 0],
        ["Worker2", 5, 0],
        ["Worker3", 5, 0],
        ["Worker4", 5, 0],
        ["Worker5", 5, 0],
        ["Worker6", 5, 0],
        ["Worker7", 5, 0],
        ["Worker8", 5, 0],
        ["Worker9", 5, 0],
        ["Worker10", 5, 0],
        ["Worker11", 5, 0],
        ["Worker12", 5, 0],
        ["Worker13", 5, 0],
        ["Worker14", 5, 0],
        ["Worker15", 5, 0],
        ["Worker10", 5, 0],
        ["Worker11", 5, 0],
        ["Worker12", 5, 0],
        ["Worker13", 5, 0],
        ["Worker14", 5, 0],
        ["Worker15", 5, 0],
        ["Worker16", 5, 0],
        ["Worker17", 5, 0],
        ["Worker18", 5, 0],
        ["Worker19", 5, 0],
        ["Worker20", 5, 0],
      ];

      var scoreB = [
        ["Role","Health","Hits"],
        ["Queen", 50, 0],
        ["Warrior1", 10, 0],
        ["Warrior2", 10, 0],
        ["Warrior3", 10, 0],
        ["Warrior4", 10, 0],
        ["Warrior5", 10, 0],
        ["Warrior6", 10, 0],
        ["Warrior7", 10, 0],
        ["Warrior8", 10, 0],
        ["Warrior9", 10, 0],
        ["Warrior10", 10, 0],
        ["Warrior11", 10, 0],
        ["Warrior12", 10, 0],
        ["Warrior13", 10, 0],
        ["Warrior14", 10, 0],
        ["Warrior15", 10, 0],
        ["Worker1", 5, 0],
        ["Worker2", 5, 0],
        ["Worker3", 5, 0],
        ["Worker4", 5, 0],
        ["Worker5", 5, 0],
        ["Worker6", 5, 0],
        ["Worker7", 5, 0],
        ["Worker8", 5, 0],
        ["Worker9", 5, 0],
        ["Worker10", 5, 0],
        ["Worker11", 5, 0],
        ["Worker12", 5, 0],
        ["Worker13", 5, 0],
        ["Worker14", 5, 0],
        ["Worker15", 5, 0],
        ["Worker10", 5, 0],
        ["Worker11", 5, 0],
        ["Worker12", 5, 0],
        ["Worker13", 5, 0],
        ["Worker14", 5, 0],
        ["Worker15", 5, 0],
        ["Worker16", 5, 0],
        ["Worker17", 5, 0],
        ["Worker18", 5, 0],
        ["Worker19", 5, 0],
        ["Worker20", 5, 0],
      ];
// reupdate the table 
      function updateTable(tableData, id) {
        document.getElementById(id).innerHTML = "";
        var table = document.createElement("table");
        if(id=='score2'){
          table.setAttribute('style','float:right;');
        }
        var header = table.createTHead();
        var rowH = header.insertRow(0);
        var cellH = rowH.insertCell(0);
        cellH.setAttribute("colspan","3");
        cellH.setAttribute("class","tg-baqh");
        cellH.innerHTML = id=="logs"?"<font style='color:blue;'><b>Logs</b></font>":(id=="score1"?"<font style='color:lime;'><b>ü¶ü Swarm A</b></font>":"<font style='color:red;'><b>ü¶ü Swarm B</b></font>");
        table.setAttribute("class", "tg");
        table.setAttribute("id", id+"H");
        var tableBody = document.createElement("tbody");
        tableData.forEach(function (rowData) {
          var row = document.createElement("tr");
          rowData.forEach(function (cellData) {
            var cell = document.createElement("td");
            cell.setAttribute("class", "tg-0lax");
            cell.appendChild(document.createTextNode(cellData));
            row.appendChild(cell);
          });

          tableBody.appendChild(row);
        });

        table.appendChild(tableBody);
        document.getElementById(id).appendChild(table);
      }

      updateTable(scoreA, "score1");
      updateTable(scoreB, "score2");

    const seconds = document.querySelector("#counter");
    
// counter
    const renderTimer = () => {
      count += 1;
      seconds.innerHTML = "‚è≥ War-time: "+ (count % 60).toString().padStart(2, "0") + " seconds up";
    }

    const timer = setInterval(renderTimer, 1000);

    </script>
  </body>
</html>
